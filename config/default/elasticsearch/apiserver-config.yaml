apiVersion: config.kjournal/v1alpha1
kind: APIServerConfig

backend:
  elasticsearch:
    url:
    - http://elasticsearch-master:9200

apis:
- resource: containerlogs
  fieldMap:
  - field: metadata.namespace
    lookup: [kubernetes.namespace_name]
  - field: metadata.creationTimestamp
    lookup: ["@timestamp"]
  - field: pod
    lookup: [kubernetes.pod_name]
  - field: container
    lookup: [kubernetes.container_name]
  - field: metadata.labels
    lookup: [kubernetes.labels]
  - field: metadata.annotations.host
    lookup: [kubernetes.host]
  - field: metadata.annotations.pod_id
    lookup: [kubernetes.pod_id]
  - field: payload
    lookup: ["."]
    drop: 
    - "@timestamp"
    - kubernetes

  backend:
    elasticsearch:
      index: logstash-*
      timestampFields: ["@timestamp"]

- resource: events
  backend:
    elasticsearch:
      index: k8sevents-*
      timestampFields: ["metadata.creationTimestamp"]

- resource: auditevents
  backend:
    elasticsearch:
      index: k8saudit-*
      timestampFields: ["stageTimestamp"]

- resource: logs
  fieldMap:
  - field: metadata.creationTimestamp
    lookup: ["@timestamp", "metadata.creationTimestamp", "stageTimestamp"]
  - field: payload
    lookup: ["."]
  backend:
    elasticsearch:
      timestampFields: ["@timestamp", "metadata.creationTimestamp"]
      index: "*"
